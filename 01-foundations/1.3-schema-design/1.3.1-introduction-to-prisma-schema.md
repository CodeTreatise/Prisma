# 1.3.1 Introduction to Prisma Schema

## 📋 Section Overview
- **Duration**: 30 minutes
- **Prerequisites**: Understanding of relational database concepts and basic SQL knowledge
- **Learning Objectives**: 
  - Understand the structure and purpose of schema.prisma file
  - Learn the basic syntax and components of Prisma schema
  - Master data source and generator configurations
  - Create your first working Prisma schema
- **Difficulty Level**: Beginner

---

## 🎯 What You'll Learn

By the end of this section, you will:
- ✅ Understand what the schema.prisma file is and why it's central to Prisma
- ✅ Configure data sources and generators properly
- ✅ Use proper Prisma schema syntax and conventions
- ✅ Create a basic schema with models and relationships
- ✅ Appreciate how schema-first development works

---

## 📖 Content

### What is the Prisma Schema?

The **Prisma schema** is like the **architectural blueprint** for your entire database and application data layer. Just as architects create detailed blueprints before construction begins, Prisma uses the schema file as the single source of truth for your data structure.

### 🏗️ The Blueprint Analogy

```
🏠 Building Construction = 📊 Database Development

📐 Architectural Blueprint (schema.prisma)
├── Foundation specs → Data sources
├── Room layouts → Models  
├── Electrical plans → Generators
├── Plumbing design → Relationships
└── Material specs → Data types

🔧 Construction Tools (Prisma CLI)
├── Foundation pouring → Database creation
├── Framework building → Migration generation
├── Systems installation → Client generation
└── Quality inspection → Type checking

🏡 Finished House (Your Application)
├── Solid foundation → Reliable database
├── Connected rooms → Related data
├── Working utilities → Generated client
└── Safety systems → Type safety
```

### 📁 Schema File Structure

The `schema.prisma` file has three main sections:

```prisma
// 1. GENERATOR CONFIGURATION
generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

// 2. DATA SOURCE CONFIGURATION  
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 3. DATA MODEL DEFINITIONS
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  posts     Post[]
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  Int
  
  author    User     @relation(fields: [authorId], references: [id])
}
```

### 🎯 Generator Configuration

The **generator** tells Prisma what to create from your schema:

#### **Basic Generator Setup**

```prisma
generator client {
  provider = "prisma-client-js"
}
```

#### **Advanced Generator Options**

```prisma
generator client {
  provider        = "prisma-client-js"
  output          = "./src/generated/client"  // Custom output location
  binaryTargets   = ["native", "linux-musl"] // For Docker deployments
  previewFeatures = ["fullTextSearch"]       // Enable preview features
}
```

#### **Multiple Generators**

```prisma
// TypeScript client
generator client {
  provider = "prisma-client-js"
}

// Entity Relationship Diagram generator
generator erd {
  provider = "prisma-erd-generator"
  output   = "./docs/erd.svg"
}

// Documentation generator
generator docs {
  provider = "prisma-docs-generator"
  output   = "./docs"
}
```

**Generator Examples:**

```
🔧 Common Prisma Generators

📦 prisma-client-js (Default)
├── Generates: TypeScript/JavaScript client
├── Use: Primary database access
└── Output: node_modules/.prisma/client/

📊 prisma-erd-generator
├── Generates: Visual database diagrams  
├── Use: Documentation and planning
└── Output: SVG/PNG diagram files

📚 prisma-docs-generator
├── Generates: API documentation
├── Use: Team documentation
└── Output: HTML documentation site

🧪 prisma-json-schema-generator
├── Generates: JSON Schema definitions
├── Use: API validation
└── Output: JSON schema files
```

### 🗄️ Data Source Configuration

The **datasource** defines which database you're connecting to:

#### **PostgreSQL Configuration**

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Example DATABASE_URL:
// postgresql://username:password@localhost:5432/mydb?schema=public
```

#### **MySQL Configuration**

```prisma
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Example DATABASE_URL:
// mysql://username:password@localhost:3306/mydb
```

#### **SQLite Configuration**

```prisma
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}
```

#### **Multiple Databases (Preview)**

```prisma
datasource db1 {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

datasource db2 {
  provider = "mysql"  
  url      = env("MYSQL_URL")
}
```

**Database Provider Comparison:**

| Provider | Best For | Production Ready | Special Features |
|----------|----------|------------------|------------------|
| **PostgreSQL** | Web applications, complex queries | ✅ Yes | JSON support, full-text search |
| **MySQL** | Traditional web apps, WordPress | ✅ Yes | Wide hosting support |
| **SQLite** | Development, small apps | ✅ Yes | File-based, no server needed |
| **SQL Server** | Enterprise, .NET apps | ✅ Yes | Windows integration |
| **MongoDB** | Document storage | 🧪 Preview | NoSQL flexibility |
| **CockroachDB** | Distributed systems | ✅ Yes | Global scalability |

### 📊 Model Definition Basics

Models represent your database tables:

#### **Basic Model Structure**

```prisma
model User {
  // Field definitions
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  bio       String?  // Optional field
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relationships
  posts     Post[]
}
```

#### **Field Anatomy**

```prisma
model User {
  id        Int      @id @default(autoincrement())
  //│       │        │   │
  //│       │        │   └── Attribute (with function)
  //│       │        └────── Attribute
  //│       └─────────────── Data type
  //└─────────────────────── Field name
  
  email     String   @unique
  //│       │        │
  //│       │        └────── Unique constraint
  //│       └─────────────── String type
  //└─────────────────────── Field name
  
  age       Int?
  //│       │ │
  //│       │ └──────────── Optional (nullable)
  //│       └────────────── Integer type
  //└────────────────────── Field name
}
```

#### **Naming Conventions**

```prisma
// ✅ Good naming conventions
model User {          // PascalCase for models
  id        Int       // camelCase for fields
  firstName String    // Descriptive field names
  isActive  Boolean   // Boolean fields start with "is/has/can"
  createdAt DateTime  // Consistent timestamp naming
}

model BlogPost {      // Descriptive model names
  id      Int
  title   String
  slug    String      // URL-friendly version of title
  authorId Int        // Foreign key naming: [relation]Id
  
  author  User @relation(fields: [authorId], references: [id])
}

// ❌ Avoid these patterns
model user {          // Don't use lowercase
  ID      String      // Don't use all caps
  nm      String      // Don't abbreviate unnecessarily  
  usr_id  Int         // Don't use snake_case
}
```

### 🎨 Schema Syntax Rules

#### **Comments and Documentation**

```prisma
/// User represents a person using our application
/// This model handles authentication and profile data
model User {
  id    Int    @id @default(autoincrement())
  
  // Authentication fields
  email    String  @unique              /// Primary email address
  password String                      /// Hashed password
  
  // Profile information
  name     String                      /// Display name
  bio      String?                     /// Optional biography
  avatar   String?                     /// Profile picture URL
  
  // Audit trail
  createdAt DateTime @default(now())   /// Account creation time
  updatedAt DateTime @updatedAt        /// Last profile update
}
```

#### **Multi-line Definitions**

```prisma
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  price       Decimal  @db.Decimal(10, 2)
  
  // Complex relationship with multiple constraints
  category    Category @relation(
    fields: [categoryId], 
    references: [id],
    onDelete: Cascade,
    onUpdate: Cascade
  )
  categoryId  Int
  
  // Composite index for performance
  @@index([categoryId, name])
  @@index([price])
}
```

#### **Environment Variables**

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = env("PRISMA_CLIENT_OUTPUT")
}

// .env file
DATABASE_URL="postgresql://user:pass@localhost:5432/mydb"
PRISMA_CLIENT_OUTPUT="./src/generated/client"
```

### 🔧 Schema Development Workflow

#### **The Schema-First Development Process**

```
📐 1. Design Phase
├── Plan your data requirements
├── Identify entities and relationships
├── Choose appropriate data types
└── Consider performance implications

📝 2. Schema Writing
├── Define models in schema.prisma
├── Set up relationships
├── Add constraints and indexes
└── Configure generators and data sources

🔄 3. Migration Generation
├── Run: prisma migrate dev
├── Review generated migration
├── Apply to development database
└── Test the changes

🎯 4. Client Generation
├── Run: prisma generate
├── Import updated client
├── Use new types in application
└── Test type safety

🚀 5. Iteration
├── Modify schema as needed
├── Generate new migrations
├── Update application code
└── Deploy to production
```

#### **Example: Building a Blog Schema Step by Step**

**Step 1: Basic User Model**
```prisma
model User {
  id    Int    @id @default(autoincrement())
  email String @unique
  name  String
}
```

**Step 2: Add Blog Posts**
```prisma
model User {
  id    Int    @id @default(autoincrement())
  email String @unique
  name  String
  posts Post[] // Add relationship
}

model Post {
  id       Int    @id @default(autoincrement())
  title    String
  content  String
  authorId Int
  author   User   @relation(fields: [authorId], references: [id])
}
```

**Step 3: Add Categories and Tags**
```prisma
model User {
  id    Int    @id @default(autoincrement())
  email String @unique
  name  String
  posts Post[]
}

model Post {
  id         Int       @id @default(autoincrement())
  title      String
  content    String
  published  Boolean   @default(false)
  authorId   Int
  categoryId Int?
  
  author     User      @relation(fields: [authorId], references: [id])
  category   Category? @relation(fields: [categoryId], references: [id])
  tags       PostTag[]
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String @unique
  posts Post[]
}

model Tag {
  id    Int       @id @default(autoincrement())
  name  String    @unique
  posts PostTag[]
}

model PostTag {
  postId Int
  tagId  Int
  post   Post @relation(fields: [postId], references: [id])
  tag    Tag  @relation(fields: [tagId], references: [id])
  
  @@id([postId, tagId])
}
```

**Step 4: Add Timestamps and Metadata**
```prisma
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]
}

model Post {
  id          Int       @id @default(autoincrement())
  title       String
  content     String
  published   Boolean   @default(false)
  publishedAt DateTime?
  authorId    Int
  categoryId  Int?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  author      User      @relation(fields: [authorId], references: [id])
  category    Category? @relation(fields: [categoryId], references: [id])
  tags        PostTag[]
  
  @@index([published, publishedAt])
  @@index([authorId])
}
```

### 💡 Best Practices for Schema Design

#### **1. Start Simple, Evolve Gradually**

```prisma
// ✅ Start with this
model User {
  id    Int    @id @default(autoincrement())
  email String @unique
  name  String
}

// ✅ Then add features as needed
model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  name      String
  bio       String?
  avatar    String?
  role      UserRole  @default(USER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  posts     Post[]
  comments  Comment[]
}

enum UserRole {
  USER
  ADMIN
  MODERATOR
}
```

#### **2. Use Descriptive Names**

```prisma
// ✅ Clear and descriptive
model BlogPost {
  id            Int      @id @default(autoincrement())
  title         String
  contentHtml   String   // Stores HTML content
  contentText   String   // Stores plain text for search
  isPublished   Boolean  @default(false)
  publishedAt   DateTime?
  authorUserId  Int
}

// ❌ Unclear and abbreviated
model Post {
  id  Int    @id @default(autoincrement())
  ttl String // What does this mean?
  txt String // Content? Summary?
  pub Boolean // Published?
  uid Int    // User ID?
}
```

#### **3. Plan for Future Requirements**

```prisma
// ✅ Extensible design
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  
  // Audit fields for compliance
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime? // Soft delete support
  
  // Extensibility
  metadata  Json?    // Store additional data as JSON
  settings  Json?    // User preferences
}

// ✅ Flexible content system
model Content {
  id          Int         @id @default(autoincrement())
  type        ContentType // POST, PAGE, PRODUCT, etc.
  title       String
  body        String
  metadata    Json?       // Type-specific fields
  status      Status      @default(DRAFT)
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

enum ContentType {
  POST
  PAGE  
  PRODUCT
  EVENT
}

enum Status {
  DRAFT
  PUBLISHED
  ARCHIVED
}
```

---

## 🧠 Knowledge Check

### Schema Structure Quiz

1. **What are the three main sections of a schema.prisma file?**
   - [ ] A) Models, Relations, Indexes
   - [x] B) Generator, Datasource, Models
   - [ ] C) Database, Client, Types
   - [ ] D) Fields, Attributes, Constraints

   **Explanation**: Every schema.prisma file has generator configuration, datasource configuration, and data model definitions.

2. **What does the generator configuration do?**
   - [x] A) Defines what Prisma should generate from the schema
   - [ ] B) Connects to the database
   - [ ] C) Creates database tables
   - [ ] D) Validates the schema syntax

   **Explanation**: The generator tells Prisma what to create (like the TypeScript client) from your schema definition.

3. **Which naming convention is recommended for Prisma models?**
   - [ ] A) snake_case
   - [ ] B) kebab-case
   - [x] C) PascalCase
   - [ ] D) UPPERCASE

   **Explanation**: Prisma recommends PascalCase for model names (User, BlogPost) and camelCase for field names.

### Schema Building Exercise

**Create a schema for a simple e-commerce system with:**
- Users (customers)
- Products 
- Orders
- Order items

**Your Schema:**
```prisma
// Write your schema here
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Add your models
```

**Sample Solution:**
```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  
  orders    Order[]
}

model Product {
  id          Int         @id @default(autoincrement())
  name        String
  description String?
  price       Decimal
  inStock     Boolean     @default(true)
  
  orderItems  OrderItem[]
}

model Order {
  id         Int         @id @default(autoincrement())
  total      Decimal
  status     String      @default("pending")
  userId     Int
  createdAt  DateTime    @default(now())
  
  user       User        @relation(fields: [userId], references: [id])
  items      OrderItem[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  quantity  Int
  price     Decimal
  orderId   Int
  productId Int
  
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
  
  @@unique([orderId, productId])
}
```

### Best Practices Assessment

**Evaluate this schema and identify improvements:**

```prisma
model user {
  id   String @id
  nm   String
  em   String
  posts post[]
}

model post {
  id  String @id
  txt String
  u_id String
  user user @relation(fields: [u_id], references: [id])
}
```

**Issues Found:**
1. _______________
2. _______________
3. _______________

**Sample Improvements:**
1. Use PascalCase for models (User, Post)
2. Use descriptive field names (name, email, content, userId)
3. Add proper data types (Int with autoincrement for IDs)
4. Add timestamps and constraints
5. Follow camelCase convention for fields

---

## 💡 Key Takeaways

- 📐 **Schema is Blueprint**: The schema.prisma file is the single source of truth for your data structure
- 🎯 **Three Key Sections**: Generator, datasource, and models form the complete schema
- 🔧 **Schema-First Development**: Design schema first, then generate client and migrations
- 📝 **Naming Matters**: Use consistent, descriptive naming conventions
- 🚀 **Start Simple**: Begin with basic models and evolve as requirements grow
- 🔗 **Relationships are Powerful**: Prisma makes complex relationships easy to define
- 🎪 **Flexibility Built-in**: JSON fields and extensible design support future changes

---

## 🔗 Navigation

**📍 Current Location**: Module 1 → Section 1.3 → Lesson 1.3.1

**⬅️ Previous**: [1.2.5 ACID Properties & Transaction Concepts](../1.2-database-fundamentals/1.2.5-acid-properties-and-transaction-concepts.md)
**➡️ Next**: [1.3.2 Data Types and Field Attributes](./1.3.2-data-types-and-field-attributes.md)

**🏠 Section Home**: [1.3 Schema Design](./README.md)
**📚 Module Home**: [Module 1: Foundations](../01-foundations.md)

**🗺️ Quick Links**:
- [Previous: Database Performance](../1.2-database-fundamentals/1.2.4-indexes-and-performance.md)
- [Next: Data Types](./1.3.2-data-types-and-field-attributes.md)
- [Jump to: Getting Started](../../02-getting-started/)

---

*Ready to explore Prisma's data types and field attributes? Continue to the next lesson!*
