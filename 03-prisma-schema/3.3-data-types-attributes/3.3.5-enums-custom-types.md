# 3.3.5 Enums & Custom Types

## Learning Objectives
By the end of this lesson, you will be able to:
- Create and implement Prisma enums for type-safe value constraints
- Design custom types for reusable data structures
- Understand enum best practices and naming conventions
- Handle enum migrations and value changes safely
- Implement complex business logic with enum combinations
- Optimize performance with proper enum usage patterns

## Introduction

Think of enums as **a restaurant's menu categories** - just as a menu constrains customer choices to "Appetizers," "Main Courses," "Desserts," and "Beverages" (preventing someone from ordering "Quantum Physics"), enums constrain your database fields to predefined, valid values. This prevents data corruption, improves query performance, and makes your application more maintainable by enforcing business rules at the schema level.

Enums transform loose string fields into type-safe, constrained choices that reflect real-world business categories.

## Basic Enum Declaration and Usage

### Simple Enum Examples
Start with straightforward value constraints:

```prisma
// User role management
enum UserRole {
  ADMIN
  MODERATOR
  USER
  GUEST
}

// Order status workflow
enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

// Product availability states
enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  DISCONTINUED
  OUT_OF_STOCK
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  role      UserRole @default(USER)      // Enum with default value
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  
  @@map("users")
}

model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique
  userId      String
  status      OrderStatus @default(PENDING)  // Workflow starts at PENDING
  total       Decimal     @db.Decimal(10, 2)
  
  // Status change tracking
  statusHistory Json      @default("[]")      // Track status transitions
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@map("orders")
}

model Product {
  id          String        @id @default(cuid())
  name        String
  sku         String        @unique
  status      ProductStatus @default(DRAFT)    // Products start as drafts
  price       Decimal       @db.Decimal(10, 2)
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  @@map("products")
}
```

### Advanced Enum Patterns
More sophisticated enum designs for complex business logic:

```prisma
// Priority levels with clear hierarchy
enum Priority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

// Task status with workflow implications
enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  IN_REVIEW
  TESTING
  DONE
  ARCHIVED
}

// Payment methods with processing requirements
enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
  BANK_TRANSFER
  CRYPTO
  GIFT_CARD
  STORE_CREDIT
}

// Notification types for different delivery channels
enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
  WEBHOOK
}

// Content moderation states
enum ModerationStatus {
  PENDING_REVIEW
  APPROVED
  REJECTED
  FLAGGED
  APPEAL_REQUESTED
  APPEAL_APPROVED
  APPEAL_REJECTED
}

model Task {
  id          String     @id @default(cuid())
  title       String
  description String?
  
  // Enum fields for business logic
  status      TaskStatus @default(BACKLOG)
  priority    Priority   @default(MEDIUM)
  
  // Assignee and tracking
  assigneeId  String?
  projectId   String
  
  // Workflow timestamps
  startedAt   DateTime?
  completedAt DateTime?
  dueDate     DateTime?
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  @@map("tasks")
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  amount        Decimal       @db.Decimal(10, 2)
  
  // Payment processing
  method        PaymentMethod
  status        OrderStatus   @default(PENDING)  // Reuse existing enum
  
  // Payment gateway data
  transactionId String?
  gatewayData   Json?         @db.JsonB
  
  processedAt   DateTime?
  createdAt     DateTime      @default(now())
  
  @@map("payments")
}
```

## Complex Enum Combinations

### Multi-Enum Models for Rich Business Logic
Combine multiple enums for sophisticated state management:

```prisma
// Subscription management with multiple state dimensions
enum SubscriptionPlan {
  FREE
  BASIC
  PREMIUM
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  SUSPENDED
  EXPIRED
  TRIAL
  PENDING_PAYMENT
}

enum BillingInterval {
  MONTHLY
  QUARTERLY
  YEARLY
}

// Content management with multiple classifications
enum ContentType {
  ARTICLE
  VIDEO
  PODCAST
  COURSE
  EBOOK
  WEBINAR
}

enum ContentCategory {
  TECHNOLOGY
  BUSINESS
  DESIGN
  MARKETING
  FINANCE
  EDUCATION
  LIFESTYLE
}

enum ContentDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model Subscription {
  id              String             @id @default(cuid())
  userId          String
  
  // Multi-dimensional subscription state
  plan            SubscriptionPlan   @default(FREE)
  status          SubscriptionStatus @default(TRIAL)
  billingInterval BillingInterval    @default(MONTHLY)
  
  // Pricing and billing
  price           Decimal            @db.Decimal(8, 2)
  currency        String             @default("USD") @db.Char(3)
  
  // Subscription lifecycle
  trialEndsAt     DateTime?
  currentPeriodStart DateTime        @default(now())
  currentPeriodEnd   DateTime
  cancelledAt     DateTime?
  
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  
  @@map("subscriptions")
}

model Content {
  id            String            @id @default(cuid())
  title         String
  slug          String            @unique
  
  // Content classification
  type          ContentType
  category      ContentCategory
  difficulty    ContentDifficulty @default(BEGINNER)
  status        ProductStatus     @default(DRAFT)  // Reuse product status
  
  // Content metadata
  description   String?
  tags          Json              @default("[]")    // Additional tagging
  duration      Int?                                // Minutes for video/audio
  wordCount     Int?                                // For articles
  
  // Publishing
  publishedAt   DateTime?
  authorId      String
  
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  
  @@index([type, category, status])
  @@map("content")
}
```

### E-commerce Advanced Enum System
Comprehensive enum design for online retail:

```prisma
// Product categorization
enum ProductCategory {
  ELECTRONICS
  CLOTHING
  HOME_GARDEN
  SPORTS
  BOOKS
  TOYS
  AUTOMOTIVE
  HEALTH_BEAUTY
}

// Shipping and fulfillment
enum ShippingMethod {
  STANDARD
  EXPRESS
  OVERNIGHT
  PICKUP
  DIGITAL_DELIVERY
}

enum FulfillmentStatus {
  PENDING
  PICKED
  PACKED
  SHIPPED
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED_DELIVERY
  RETURNED
}

// Customer service
enum SupportTicketType {
  TECHNICAL_ISSUE
  BILLING_INQUIRY
  RETURN_REQUEST
  PRODUCT_QUESTION
  COMPLAINT
  FEATURE_REQUEST
  ACCOUNT_ISSUE
}

enum TicketPriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_CUSTOMER
  WAITING_VENDOR
  RESOLVED
  CLOSED
  ESCALATED
}

model EcommerceProduct {
  id            String          @id @default(cuid())
  name          String
  sku           String          @unique
  
  // Product classification
  category      ProductCategory
  subcategory   String?                           // Free-form subcategory
  status        ProductStatus   @default(DRAFT)
  
  // Pricing and inventory
  price         Decimal         @db.Decimal(10, 2)
  comparePrice  Decimal?        @db.Decimal(10, 2)
  cost          Decimal         @db.Decimal(10, 2)
  inventory     Int             @default(0)
  
  // Product attributes
  weight        Float?
  dimensions    Json?           @db.JsonB         // Length, width, height
  
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  @@index([category, status])
  @@map("ecommerce_products")
}

model Shipment {
  id              String            @id @default(cuid())
  orderId         String
  trackingNumber  String?           @unique
  
  // Shipping details
  method          ShippingMethod
  status          FulfillmentStatus @default(PENDING)
  
  // Address and carrier
  carrier         String?
  shippingAddress Json              @db.JsonB
  
  // Timeline
  estimatedDelivery DateTime?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([status, shippedAt])
  @@map("shipments")
}

model SupportTicket {
  id          String            @id @default(cuid())
  ticketNumber String           @unique @default(cuid())
  
  // Customer and classification
  customerId  String
  type        SupportTicketType
  priority    TicketPriority    @default(NORMAL)
  status      TicketStatus      @default(OPEN)
  
  // Content
  subject     String
  description String
  
  // Assignment and resolution
  assignedTo  String?
  resolvedAt  DateTime?
  closedAt    DateTime?
  
  // SLA tracking
  firstResponseAt DateTime?
  responseTime    Int?                            // Minutes to first response
  resolutionTime  Int?                            // Minutes to resolution
  
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  @@index([status, priority, createdAt])
  @@index([type, status])
  @@map("support_tickets")
}
```

## Enum Best Practices and Patterns

### Naming Conventions and Organization
Consistent, scalable enum naming:

```prisma
// ✅ Good: Clear, hierarchical naming
enum UserAccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
  BANNED
}

enum OrderPaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum ProductInventoryStatus {
  IN_STOCK
  LOW_STOCK
  OUT_OF_STOCK
  BACKORDERED
  DISCONTINUED
}

// ✅ Good: Workflow-aware enum values
enum ProjectPhase {
  PLANNING
  DEVELOPMENT
  TESTING
  DEPLOYMENT
  MAINTENANCE
  ARCHIVED
}

// ✅ Good: Business-specific terminology
enum ContractStatus {
  DRAFT
  UNDER_REVIEW
  APPROVED
  ACTIVE
  EXPIRED
  TERMINATED
  RENEWED
}

model UserAccount {
  id          String            @id @default(cuid())
  email       String            @unique
  status      UserAccountStatus @default(PENDING_VERIFICATION)
  
  // Related enum fields
  role        UserRole          @default(USER)
  
  createdAt   DateTime          @default(now())
  
  @@map("user_accounts")
}
```

### Enum Evolution and Migration Strategies
Handle enum changes safely in production:

```prisma
// Version 1: Initial enum
enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
}

// Version 2: Added cancellation support
enum OrderStatusV2 {
  PENDING
  CONFIRMED
  PROCESSING    // New: Added processing step
  SHIPPED
  DELIVERED
  CANCELLED     // New: Added cancellation
  REFUNDED      // New: Added refund tracking
}

// Version 3: Enhanced workflow
enum OrderStatusV3 {
  PENDING
  PAYMENT_PENDING    // New: Separate payment state
  CONFIRMED
  PROCESSING
  PACKED            // New: Fulfillment detail
  SHIPPED
  OUT_FOR_DELIVERY  // New: Delivery tracking
  DELIVERED
  CANCELLED
  REFUNDED
  RETURNED          // New: Returns handling
}

// Migration-safe enum design
model OrderWithStatus {
  id            String    @id @default(cuid())
  
  // Current status system
  status        OrderStatusV3 @default(PENDING)
  
  // Legacy status tracking for migrations
  legacyStatus  String?                           // Backup during migration
  
  // Status change audit trail
  statusHistory Json      @default("[]")          // Track all status changes
  statusChangedAt DateTime @default(now())
  statusChangedBy String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("orders_with_status")
}
```

### Complex Business Rules with Enums
Implement sophisticated business logic:

```prisma
// Employee management with role hierarchy
enum EmployeeLevel {
  INTERN
  JUNIOR
  SENIOR
  LEAD
  MANAGER
  DIRECTOR
  VP
  C_LEVEL
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
  CONSULTANT
}

enum EmployeeStatus {
  ACTIVE
  ON_LEAVE
  SUSPENDED
  TERMINATED
  RETIRED
}

// Department-specific roles
enum Department {
  ENGINEERING
  DESIGN
  MARKETING
  SALES
  FINANCE
  HR
  OPERATIONS
  LEGAL
}

model Employee {
  id              String         @id @default(cuid())
  employeeId      String         @unique
  
  // Personal information
  firstName       String
  lastName        String
  email           String         @unique
  
  // Employment details with multiple enum dimensions
  level           EmployeeLevel
  type            EmploymentType
  status          EmployeeStatus @default(ACTIVE)
  department      Department
  
  // Compensation and role
  title           String
  salary          Decimal?       @db.Decimal(10, 2)
  
  // Employment dates
  hireDate        DateTime       @default(now())
  terminationDate DateTime?
  
  // Manager relationship (self-referential)
  managerId       String?
  manager         Employee?      @relation("ManagerReports", fields: [managerId], references: [id])
  reports         Employee[]     @relation("ManagerReports")
  
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  @@index([department, level, status])
  @@index([managerId])
  @@map("employees")
}

// Project management with complex states
enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
  ARCHIVED
}

enum ProjectPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ProjectType {
  INTERNAL
  CLIENT
  RESEARCH
  MAINTENANCE
  EMERGENCY
}

model Project {
  id          String          @id @default(cuid())
  name        String
  code        String          @unique
  
  // Project classification
  type        ProjectType
  status      ProjectStatus   @default(PLANNING)
  priority    ProjectPriority @default(MEDIUM)
  
  // Project details
  description String?
  budget      Decimal?        @db.Decimal(12, 2)
  
  // Timeline
  startDate   DateTime?
  endDate     DateTime?
  actualEnd   DateTime?
  
  // Team assignment
  managerId   String
  teamSize    Int             @default(1)
  
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  
  @@index([status, priority])
  @@index([type, status])
  @@map("projects")
}
```

## Performance Optimization with Enums

### Indexing and Query Optimization
Leverage enums for efficient database operations:

```prisma
enum EventType {
  USER_LOGIN
  USER_LOGOUT
  PURCHASE
  PAGE_VIEW
  ERROR
  SYSTEM_ALERT
}

enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
  FATAL
}

model Analytics {
  id          String    @id @default(cuid())
  
  // Enum fields for efficient filtering
  eventType   EventType
  level       LogLevel  @default(INFO)
  
  // Event data
  userId      String?
  sessionId   String?
  metadata    Json      @db.JsonB
  
  // Timestamp for time-series queries
  timestamp   DateTime  @default(now())
  
  // Strategic indexes using enum fields
  @@index([eventType, timestamp])        // Event type analysis
  @@index([level, timestamp])            // Log level filtering
  @@index([userId, eventType])           // User behavior analysis
  @@index([sessionId, timestamp])        // Session analysis
  
  @@map("analytics")
}

model AuditTrail {
  id            String    @id @default(cuid())
  
  // Audit classification
  action        String
  resourceType  String
  resourceId    String
  
  // User and system tracking
  userId        String?
  level         LogLevel  @default(INFO)
  
  // Audit data
  changes       Json      @db.JsonB
  metadata      Json      @default("{}")
  
  timestamp     DateTime  @default(now())
  
  // Optimized for audit queries
  @@index([resourceType, resourceId, timestamp])
  @@index([userId, timestamp])
  @@index([level, timestamp])
  
  @@map("audit_trail")
}
```

### Enum-Based Partitioning Strategies
Design schemas that support database partitioning:

```prisma
enum TimeZone {
  UTC
  EST
  PST
  GMT
  CET
  JST
  AEST
}

enum DataCenter {
  US_EAST
  US_WEST
  EU_CENTRAL
  ASIA_PACIFIC
}

model DistributedData {
  id            String     @id @default(cuid())
  
  // Partitioning dimensions
  region        DataCenter @default(US_EAST)
  timezone      TimeZone   @default(UTC)
  
  // Data payload
  data          Json       @db.JsonB
  
  timestamp     DateTime   @default(now())
  
  // Partition-friendly indexes
  @@index([region, timestamp])
  @@index([timezone, timestamp])
  
  @@map("distributed_data")
}
```

## Common Enum Anti-Patterns

### ❌ Patterns to Avoid
Learn from common mistakes:

```prisma
// ❌ Bad: Too granular, difficult to maintain
enum VerySpecificStatus {
  PENDING_REVIEW_BY_JOHN
  PENDING_REVIEW_BY_JANE
  APPROVED_BY_JOHN
  APPROVED_BY_JANE
  // ... This will become unmaintainable
}

// ❌ Bad: Unclear meaning
enum Status {
  A
  B
  C
  D
}

// ❌ Bad: Mixing different concepts
enum MixedValues {
  PENDING
  APPROVED
  MONDAY
  TUESDAY
  HIGH_PRIORITY
  LOW_PRIORITY
}

// ✅ Good: Clear, maintainable alternatives
enum ReviewStatus {
  PENDING_REVIEW
  APPROVED
  REJECTED
  REQUIRES_CHANGES
}

enum WeekDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// ✅ Good: Separate concerns into different enums
model GoodExample {
  id          String       @id @default(cuid())
  status      ReviewStatus @default(PENDING_REVIEW)
  priority    Priority     @default(MEDIUM)
  dueDay      WeekDay?
  
  @@map("good_examples")
}
```

## Exercise: Design a Complete Enum-Driven System

Design a comprehensive project management system using enums effectively:

```prisma
// Your task: Create appropriate enums and models for a project management system

// 1. Create enums for project management
enum ProjectStatus {
  // Add appropriate project statuses
}

enum TaskPriority {
  // Add priority levels
}

enum UserRole {
  // Add user roles for project management
}

// 2. Create a comprehensive project model
model ProjectManagement {
  id          String   @id @default(cuid())
  name        String
  
  // Add appropriate enum fields
  // Add relationships and constraints
  // Add proper indexes
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Add table mapping
}

// 3. Create supporting models with enum relationships
// - User model with roles
// - Task model with priorities and statuses  
// - Comment model with types
// - File attachment model with categories
```

## Key Takeaways

1. **Type Safety**: Enums provide compile-time type checking and prevent invalid values
2. **Business Logic**: Use enums to encode business rules and workflows directly in schema
3. **Performance**: Enum fields are efficient for indexing and querying
4. **Maintainability**: Well-designed enums make code self-documenting and easier to maintain
5. **Migration Planning**: Plan enum evolution carefully to avoid breaking changes
6. **Naming Consistency**: Use clear, consistent naming conventions for enum values
7. **Single Responsibility**: Keep enums focused on single concepts or workflows

## Next Steps

Congratulations! You've completed **Section 3.3 Data Types & Attributes**. In the next section, we'll explore **Relationships & Relations** and learn how to connect your models together to create sophisticated relational data structures with proper foreign keys and constraints.

---

**Estimated Time:** 18 minutes
**Difficulty:** Intermediate-Advanced
**Prerequisites:** Understanding of data types, field attributes, and basic database design principles
