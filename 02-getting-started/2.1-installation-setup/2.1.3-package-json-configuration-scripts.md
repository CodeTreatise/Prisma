# 2.1.3 Package.json Configuration & Scripts

## 📋 Section Overview
- **Duration**: 25 minutes
- **Prerequisites**: 
  - Completed 2.1.1: Installing Prisma CLI & Client
  - Completed 2.1.2: Project Initialization with `prisma init`
  - Understanding of npm scripts and package.json structure
  - Basic knowledge of command-line operations
- **Learning Objectives**: 
  - Configure package.json for optimal Prisma development
  - Create efficient npm scripts for common Prisma operations
  - Understand script organization and naming conventions
  - Set up development, build, and deployment scripts
  - Implement script chaining and dependencies
- **Difficulty Level**: Beginner to Intermediate

---

## 🎯 What You'll Learn

By the end of this section, you will:
- ✅ Configure comprehensive npm scripts for Prisma workflows
- ✅ Organize scripts for different development phases
- ✅ Implement script dependencies and chaining
- ✅ Create shortcuts for frequent Prisma operations
- ✅ Set up automated workflows for team collaboration
- ✅ Understand script best practices and conventions
- ✅ Troubleshoot common script configuration issues

---

## 📖 Content

### Understanding Package.json for Prisma Development

Configuring package.json scripts for Prisma is like **organizing a master control panel for a spaceship**. Just as astronauts need quick access to critical systems through well-labeled buttons and automated sequences, developers need efficient npm scripts that provide instant access to essential Prisma operations with clear, memorable commands.

### 🚀 The Spaceship Control Panel Analogy

```
🚀 Spaceship Control Panel = 📄 package.json Scripts

🎛️ Primary Controls (Essential Scripts)
├── Engine start → npm run dev
├── Navigation → npm run migrate
├── Life support → npm run generate
├── Communications → npm run studio
├── Diagnostics → npm run validate
└── Emergency reset → npm run reset

🔄 Automated Sequences (Script Chains)
├── Launch sequence → npm run setup
├── System check → npm run test
├── Maintenance cycle → npm run maintain
├── Deployment prep → npm run build
├── Mission ready → npm run deploy
└── Safe shutdown → npm run cleanup

📊 Mission Control (Development Workflow)
├── Pre-flight check → Dependency validation
├── System initialization → Database setup
├── Course correction → Migration management
├── Status monitoring → Health checks
├── Data transmission → Client generation
└── Mission logging → Debug and monitoring

🛡️ Safety Systems (Error Prevention)
├── Warning alerts → Validation scripts
├── Backup protocols → Database backups
├── Emergency procedures → Reset and recovery
├── System isolation → Environment separation
├── Quality control → Testing automation
└── Mission documentation → Script documentation
```

---

## 📦 Essential Prisma Scripts

### 1. Core Development Scripts

These scripts handle the fundamental Prisma operations you'll use daily:

```json
{
  "scripts": {
    "dev": "ts-node src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio",
    "prisma:reset": "prisma migrate reset --force",
    "prisma:deploy": "prisma migrate deploy",
    "prisma:format": "prisma format",
    "prisma:validate": "prisma validate"
  }
}
```

#### **Script Explanations:**

**Development Scripts:**
- `dev`: Start development server with hot reloading
- `build`: Compile TypeScript to JavaScript
- `start`: Run compiled application

**Prisma Core Scripts:**
- `prisma:generate`: Generate Prisma Client from schema
- `prisma:migrate`: Create and apply migrations in development
- `prisma:studio`: Open Prisma Studio database browser
- `prisma:reset`: Reset database and apply all migrations
- `prisma:deploy`: Apply migrations in production
- `prisma:format`: Format schema.prisma file
- `prisma:validate`: Validate schema syntax and configuration

### 2. Advanced Workflow Scripts

Enhanced scripts for complex operations and automation:

```json
{
  "scripts": {
    "db:setup": "prisma migrate dev && prisma generate && prisma db seed",
    "db:reset": "prisma migrate reset --force && prisma db seed",
    "db:seed": "ts-node prisma/seed.ts",
    "db:pull": "prisma db pull && prisma generate",
    "db:push": "prisma db push && prisma generate",
    
    "prisma:migrate:create": "prisma migrate dev --create-only",
    "prisma:migrate:status": "prisma migrate status",
    "prisma:migrate:resolve": "prisma migrate resolve",
    
    "test": "jest",
    "test:watch": "jest --watch",
    "test:db": "NODE_ENV=test npm run db:setup && jest",
    
    "type-check": "tsc --noEmit",
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix"
  }
}
```

#### **Advanced Script Categories:**

**Database Management:**
- `db:setup`: Complete database initialization with seeding
- `db:reset`: Clean reset with fresh seed data
- `db:seed`: Run database seeding script
- `db:pull`: Introspect existing database and update schema
- `db:push`: Push schema changes without creating migrations

**Migration Management:**
- `prisma:migrate:create`: Create migration without applying
- `prisma:migrate:status`: Check migration status
- `prisma:migrate:resolve`: Resolve migration conflicts

**Quality Assurance:**
- `test`: Run test suite
- `test:watch`: Run tests in watch mode
- `test:db`: Set up test database and run tests
- `type-check`: TypeScript type checking without compilation
- `lint`: Code quality checking
- `lint:fix`: Automatic code formatting

### 3. Environment-Specific Scripts

Scripts tailored for different environments:

```json
{
  "scripts": {
    "dev:setup": "npm install && prisma generate && prisma migrate dev && prisma db seed",
    "dev:reset": "prisma migrate reset --force && prisma db seed && npm run dev",
    "dev:fresh": "rm -rf node_modules prisma/migrations && npm install && prisma init",
    
    "staging:deploy": "prisma migrate deploy && prisma generate && npm run build",
    "staging:reset": "prisma migrate reset --force && prisma db seed",
    
    "prod:deploy": "prisma migrate deploy && prisma generate",
    "prod:status": "prisma migrate status",
    
    "docker:dev": "docker-compose up -d && npm run dev",
    "docker:down": "docker-compose down",
    "docker:reset": "docker-compose down -v && docker-compose up -d && npm run db:setup"
  }
}
```

---

## 🔗 Script Dependencies and Chaining

### 1. Sequential Script Execution

Use `&&` to chain scripts that must run in sequence:

```json
{
  "scripts": {
    "setup": "npm install && prisma generate && prisma migrate dev && prisma db seed",
    "build:full": "npm run type-check && npm run lint && npm run test && npm run build",
    "deploy:safe": "npm run test && npm run build && prisma migrate deploy"
  }
}
```

### 2. Parallel Script Execution

Use `npm-run-all` for parallel execution:

```bash
# Install npm-run-all
npm install --save-dev npm-run-all
```

```json
{
  "scripts": {
    "test:all": "npm-run-all --parallel test lint type-check",
    "build:check": "npm-run-all --parallel type-check lint",
    "dev:services": "npm-run-all --parallel dev prisma:studio"
  }
}
```

### 3. Conditional Script Execution

Use `||` for fallback operations:

```json
{
  "scripts": {
    "migrate:safe": "prisma migrate dev || prisma migrate reset --force",
    "start:any": "npm start || npm run dev",
    "test:fallback": "jest || echo 'Tests failed but continuing...'"
  }
}
```

---

## ⚙️ Complete Package.json Configuration

### Comprehensive Example

Here's a complete package.json optimized for Prisma development:

```json
{
  "name": "my-prisma-app",
  "version": "1.0.0",
  "description": "A modern application built with Prisma",
  "main": "dist/index.js",
  "scripts": {
    "dev": "nodemon --exec ts-node src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "clean": "rimraf dist",
    
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:studio": "prisma studio --port 5555",
    "prisma:reset": "prisma migrate reset --force",
    "prisma:deploy": "prisma migrate deploy",
    "prisma:format": "prisma format",
    "prisma:validate": "prisma validate",
    "prisma:pull": "prisma db pull",
    "prisma:push": "prisma db push",
    
    "db:setup": "prisma migrate dev && prisma generate && npm run db:seed",
    "db:reset": "prisma migrate reset --force && npm run db:seed",
    "db:seed": "ts-node prisma/seed.ts",
    "db:studio": "prisma studio",
    
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:db": "NODE_ENV=test npm run db:setup && jest",
    
    "type-check": "tsc --noEmit",
    "type-check:watch": "tsc --noEmit --watch",
    "lint": "eslint src --ext .ts",
    "lint:fix": "eslint src --ext .ts --fix",
    "format": "prettier --write \"src/**/*.ts\"",
    
    "setup": "npm install && npm run prisma:generate && npm run db:setup",
    "setup:fresh": "npm run clean && npm install && npm run db:reset",
    "build:full": "npm run type-check && npm run lint && npm run test && npm run build",
    "dev:full": "npm run setup && npm-run-all --parallel dev prisma:studio",
    
    "docker:up": "docker-compose up -d",
    "docker:down": "docker-compose down",
    "docker:reset": "docker-compose down -v && docker-compose up -d && npm run db:setup",
    
    "postinstall": "prisma generate",
    "prepublishOnly": "npm run build:full"
  },
  "prisma": {
    "seed": "ts-node prisma/seed.ts"
  },
  "dependencies": {
    "@prisma/client": "^5.3.1"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "eslint": "^8.0.0",
    "jest": "^29.0.0",
    "nodemon": "^3.0.0",
    "npm-run-all": "^4.1.5",
    "prettier": "^3.0.0",
    "prisma": "^5.3.1",
    "rimraf": "^5.0.0",
    "ts-jest": "^29.0.0",
    "ts-node": "^10.9.0",
    "typescript": "^5.0.0"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

### Key Configuration Sections

#### **Prisma Configuration Block:**
```json
{
  "prisma": {
    "seed": "ts-node prisma/seed.ts"
  }
}
```

This tells Prisma how to run your seed script when using `prisma db seed`.

#### **Node.js Version Specification:**
```json
{
  "engines": {
    "node": ">=18.0.0"
  }
}
```

Ensures compatibility with Prisma's requirements.

#### **Lifecycle Hooks:**
```json
{
  "scripts": {
    "postinstall": "prisma generate",
    "prepublishOnly": "npm run build:full"
  }
}
```

- `postinstall`: Automatically generates Prisma Client after dependencies are installed
- `prepublishOnly`: Runs full build validation before publishing

---

## 🛠️ Development Workflow Scripts

### 1. Daily Development Scripts

```json
{
  "scripts": {
    "morning": "git pull && npm install && npm run db:setup",
    "work": "npm-run-all --parallel dev prisma:studio",
    "sync": "npm run prisma:pull && npm run prisma:generate",
    "commit": "npm run lint:fix && npm run type-check && git add ."
  }
}
```

### 2. Team Collaboration Scripts

```json
{
  "scripts": {
    "team:setup": "npm install && npm run db:reset && echo 'Setup complete! Run npm run dev to start.'",
    "team:sync": "git pull && npm install && npm run prisma:migrate && npm run prisma:generate",
    "team:status": "npm run prisma:migrate:status && npm run type-check",
    "team:reset": "npm run db:reset && echo 'Database reset complete for all team members.'"
  }
}
```

### 3. CI/CD Pipeline Scripts

```json
{
  "scripts": {
    "ci:install": "npm ci",
    "ci:build": "npm run type-check && npm run lint && npm run build",
    "ci:test": "npm run test:coverage",
    "ci:deploy": "npm run prisma:deploy && npm run build",
    "ci:validate": "npm run prisma:validate && npm run type-check"
  }
}
```

---

## 🔧 Script Optimization and Best Practices

### 1. Performance Optimization

```json
{
  "scripts": {
    "dev:fast": "ts-node --transpile-only src/index.ts",
    "build:fast": "tsc --incremental",
    "test:fast": "jest --onlyChanged",
    "prisma:gen:fast": "prisma generate --no-engine"
  }
}
```

### 2. Cross-Platform Compatibility

```json
{
  "scripts": {
    "clean": "rimraf dist",
    "copy:assets": "copyfiles -u 1 src/assets/**/* dist/",
    "env:check": "cross-env NODE_ENV=development node -e \"console.log(process.env.NODE_ENV)\""
  }
}
```

Required packages:
```bash
npm install --save-dev rimraf copyfiles cross-env
```

### 3. Error Handling and Logging

```json
{
  "scripts": {
    "migrate:safe": "npm run prisma:validate && npm run prisma:migrate || echo 'Migration failed - check your schema'",
    "build:verbose": "tsc --verbose",
    "test:debug": "DEBUG=* jest --verbose",
    "dev:log": "DEBUG=prisma:* npm run dev"
  }
}
```

---

## 🧠 Knowledge Check

### Package.json Scripts Quiz

1. **What does the `postinstall` script do in a Prisma project?**
   - [ ] A) Runs tests after installation
   - [x] B) Automatically generates Prisma Client after dependencies are installed
   - [ ] C) Sets up the database
   - [ ] D) Starts the development server

   **Explanation**: The `postinstall` script runs automatically after `npm install` completes, ensuring Prisma Client is always generated when dependencies are installed.

2. **Which operator chains scripts to run sequentially?**
   - [ ] A) `|`
   - [x] B) `&&`
   - [ ] C) `||`
   - [ ] D) `&`

   **Explanation**: The `&&` operator ensures scripts run in sequence, with each script only running if the previous one succeeds.

3. **What's the purpose of the `prisma` configuration block in package.json?**
   - [ ] A) Define Prisma version
   - [x] B) Configure how `prisma db seed` runs
   - [ ] C) Set database connection
   - [ ] D) Define schema location

   **Explanation**: The `prisma` block in package.json configures Prisma-specific settings, including how the seed command should execute.

### Practical Exercise: Complete Script Configuration

**Challenge**: Set up a comprehensive package.json for a blog application

**Requirements**:
1. Add all essential Prisma scripts
2. Create development workflow scripts
3. Set up testing and validation scripts
4. Add environment-specific deployment scripts
5. Configure lifecycle hooks

```json
{
  "name": "blog-app",
  "version": "1.0.0",
  "scripts": {
    // Add your scripts here
  },
  "prisma": {
    // Add Prisma configuration
  }
}
```

**Validation Checklist**:
- [ ] Core Prisma operations (generate, migrate, studio, reset)
- [ ] Development workflow (dev, build, start)
- [ ] Database management (setup, seed, reset)
- [ ] Quality assurance (test, lint, type-check)
- [ ] Environment-specific scripts (dev, staging, prod)
- [ ] Lifecycle hooks (postinstall, prepublishOnly)
- [ ] Script chaining and error handling

---

## 💡 Key Takeaways

- 🎛️ **Control Panel**: Well-organized scripts provide instant access to all Prisma operations
- 🔗 **Script Chaining**: Use `&&` for sequential execution and `||` for fallbacks
- 🚀 **Automation**: Lifecycle hooks automate routine tasks like client generation
- 👥 **Team Collaboration**: Standardized scripts ensure consistent workflows across team members
- 🛠️ **Development Efficiency**: Grouped scripts reduce context switching and command memorization
- 🔧 **Environment Management**: Separate scripts for different environments prevent deployment mistakes
- 📋 **Best Practices**: Clear naming conventions and documentation make scripts maintainable
- ⚡ **Performance**: Optimized scripts with flags and caching improve development speed

---

## 🔗 Navigation

**📍 Current Location**: Module 2 → Section 2.1 → Lesson 2.1.3

**⬅️ Previous**: [2.1.2 Project Initialization with `prisma init`](./2.1.2-project-initialization-prisma-init.md)
**➡️ Next**: [2.1.4 Environment Variables & .env Setup](./2.1.4-environment-variables-env-setup.md)

**🏠 Section Home**: [2.1 Installation & Setup](./README.md)
**📚 Module Home**: [Module 2: Getting Started](../02-getting-started.md)

**🗺️ Quick Links**:
- [Previous: Project Initialization](./2.1.2-project-initialization-prisma-init.md)
- [Next: Environment Variables](./2.1.4-environment-variables-env-setup.md)
- [Jump to: First Schema](../2.2-first-prisma-project/2.2.1-creating-your-first-schema.md)

---

*Excellent! You've set up a professional script workflow for Prisma development. Ready to master environment variable configuration? Continue to the next lesson!*
